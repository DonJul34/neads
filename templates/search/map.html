{% extends 'base.html' %}
{% load static %}

{% block title %}Recherche de créateurs par carte | NEADS{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
    .map-container {
        position: relative;
        height: 600px;
        width: 100%;
    }
    
    #map {
        height: 100%;
        width: 100%;
        z-index: 1;
    }
    
    .map-search-panel {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 1000;
        background-color: white;
        padding: 15px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        width: 300px;
        max-width: 100%;
    }
    
    .map-filters {
        margin-top: 10px;
    }
    
    .map-controls {
        position: absolute;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .map-controls button {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: white;
        border: none;
        box-shadow: 0 0 5px rgba(0,0,0,0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }
    
    .radius-control {
        padding: 10px;
        background-color: white;
        border-radius: 5px;
        box-shadow: 0 0 5px rgba(0,0,0,0.2);
        margin-top: 10px;
    }
    
    .creators-list {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 1000;
        background-color: white;
        padding: 15px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        width: 300px;
        max-height: 580px;
        overflow-y: auto;
    }
    
    .creator-item {
        padding: 10px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
    }
    
    .creator-item:hover {
        background-color: #f8f9fa;
    }
    
    @media (max-width: 768px) {
        .map-search-panel, .creators-list {
            position: relative;
            width: 100%;
            max-height: 300px;
            margin-bottom: 10px;
        }
        
        .map-container {
            height: 400px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-md-12">
            <h1>Recherche de créateurs par carte</h1>
            <p class="lead">Trouvez des créateurs autour de vous ou dans une zone spécifique.</p>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-12">
            <div class="map-container">
                <!-- Carte -->
                <div id="map"></div>
                
                <!-- Panneau de recherche -->
                <div class="map-search-panel">
                    <form id="map-search-form">
                        <div class="input-group mb-3">
                            <input type="text" id="map-search-query" class="form-control" placeholder="Rechercher un créateur...">
                            <button class="btn btn-primary" type="submit">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        
                        <div id="map-filters" class="map-filters">
                            <div class="mb-2">
                                <label for="map-domain-filter" class="form-label small">Domaine</label>
                                <select id="map-domain-filter" class="form-select form-select-sm">
                                    <option value="all">Tous les domaines</option>
                                    {% for domain in domains %}
                                    <option value="{{ domain.id }}">{{ domain.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="mb-2">
                                <label for="map-platform-filter" class="form-label small">Plateforme</label>
                                <select id="map-platform-filter" class="form-select form-select-sm">
                                    <option value="all">Toutes les plateformes</option>
                                    <option value="instagram">Instagram</option>
                                    <option value="youtube">YouTube</option>
                                    <option value="tiktok">TikTok</option>
                                    <option value="twitter">Twitter</option>
                                </select>
                            </div>
                            
                            <div class="mb-2">
                                <label for="map-min-followers" class="form-label small">Followers minimum</label>
                                <input type="number" id="map-min-followers" class="form-control form-control-sm" min="0" placeholder="Nombre de followers minimum">
                            </div>
                            
                            <div class="radius-control">
                                <label for="radius-selector" class="form-label small">Rayon de recherche: <span id="radius-value">50</span> km</label>
                                <input type="range" class="form-range" id="radius-selector" min="1" max="500" value="50" 
                                       oninput="document.getElementById('radius-value').textContent = this.value">
                            </div>
                            
                            <div class="mt-2">
                                <button type="button" id="reset-filters-btn" class="btn btn-sm btn-outline-secondary w-100">
                                    <i class="fas fa-undo-alt"></i> Réinitialiser les filtres
                                </button>
                            </div>
                        </div>
                    </form>
                    
                    <div class="mt-3 small text-muted">
                        <span id="results-counter">0</span> créateurs trouvés
                    </div>
                </div>
                
                <!-- Contrôles de la carte -->
                <div class="map-controls">
                    <button id="locate-me-btn" title="Ma position">
                        <i class="fas fa-location-arrow"></i>
                    </button>
                    <button id="fullscreen-btn" title="Plein écran">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
                
                <!-- Liste des créateurs -->
                <div class="creators-list d-none d-md-block">
                    <h5>Créateurs à proximité</h5>
                    <div id="creators-list-container">
                        <div class="text-center py-4" id="map-loading-indicator">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Chargement...</span>
                            </div>
                        </div>
                        <div id="creators-list-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{% static 'js/map/location.js' %}"></script>
<script src="{% static 'js/map/map-manager.js' %}"></script>
<script src="{% static 'js/map/search-creators.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialiser la carte
        MapManager.init('map');
        
        // Initialiser le module de recherche
        SearchCreators.init();
        
        // Bouton de réinitialisation des filtres
        document.getElementById('reset-filters-btn').addEventListener('click', function() {
            SearchCreators.reset();
        });
        
        // Bouton ma position
        document.getElementById('locate-me-btn').addEventListener('click', function() {
            MapManager.locateUser();
        });
        
        // Bouton plein écran
        document.getElementById('fullscreen-btn').addEventListener('click', function() {
            const mapContainer = document.querySelector('.map-container');
            
            if (document.fullscreenElement) {
                document.exitFullscreen();
                document.getElementById('fullscreen-btn').innerHTML = '<i class="fas fa-expand"></i>';
            } else {
                mapContainer.requestFullscreen();
                document.getElementById('fullscreen-btn').innerHTML = '<i class="fas fa-compress"></i>';
            }
        });
    });
</script>
{% endblock %} 